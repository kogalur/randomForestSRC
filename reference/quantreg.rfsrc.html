<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quantile Regression Forests — quantreg.rfsrc • Random Forests for Survival, Regression, and Classification</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Quantile Regression Forests — quantreg.rfsrc" />
<meta property="og:description" content="Grows a univariate or multivariate quantile regression forest and returns
  its conditional quantile and density values.  Can be used for
  both training and testing purposes." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-000000-01"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-000000-01');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Random Forests for Survival, Regression, and Classification</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">2.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/getstarted.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getstarted.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/rfsrc-introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/installation.html">Installing randomForestSRC</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Speedup Random Forest Analyses</a>
    </li>
    <li>
      <a href="../articles/regression.html">Regression Problem</a>
    </li>
    <li>
      <a href="../articles/classification.html">Classification Problem</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Problem</a>
    </li>
    <li>
      <a href="../articles/imbalance.html">Classifiers for Class Imbalanced Data</a>
    </li>
    <li>
      <a href="../articles/rfsrc-subsample.html">Variable Importance with Subsampling Inferences</a>
    </li>
    <li>
      <a href="../articles/partial.html">Partial Plot</a>
    </li>
    <li>
      <a href="../articles/trees.html">Inferences from Trees</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/issues">Bug Reporting</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kogalur/randomForestSRC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantile Regression Forests</h1>
    
    <div class="hidden name"><code>quantreg.rfsrc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Grows a univariate or multivariate quantile regression forest and returns
  its conditional quantile and density values.  Can be used for
  both training and testing purposes.</p>
    </div>

    <pre class="usage"><span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>formula</span>, <span class='va'>data</span>, <span class='va'>object</span>, <span class='va'>newdata</span>,
  method <span class='op'>=</span> <span class='st'>"local"</span>, splitrule <span class='op'>=</span> <span class='cn'>NULL</span>, prob <span class='op'>=</span> <span class='cn'>NULL</span>, prob.epsilon <span class='op'>=</span> <span class='cn'>NULL</span>,
  oob <span class='op'>=</span> <span class='cn'>TRUE</span>, fast <span class='op'>=</span> <span class='cn'>FALSE</span>, maxn <span class='op'>=</span> <span class='fl'>1e3</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A symbolic description of the model to be fit.
    Must be specified unless <code>object</code> is given.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>Data frame containing the y-outcome and x-variables in
    the model. Must be specified unless <code>object</code> is given.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>(Optional) A previously grown quantile regression
    forest.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Method used to calculate quantiles.  Three methods are
    provided. Forest weighted averaging (<code>method = "forest"</code>) is
    the standard method provided in most random forest packages.  A
    second method is the Greenwald-Khanna algorithm which is suited for
    big data and is specified by any one of the following: "gk", "GK",
    "G-K", "g-k".  The third method (<code>method = "local"</code>) is the
    default method used and uses the local adjusted cdf approach of
    Zhang et al. (2019).  This does not use forest weights and is
    therefore reasonably fast and can be used for large data - however
    it relies on the assumption of a homogeneous (equal variance) error
    distribution which can be a strong assumption and undesireable
    consequences can result if the assumption is violated.  See below
    for further discussion.</p></td>
    </tr>
    <tr>
      <th>splitrule</th>
      <td><p>The default action is local adaptive quantile regression splitting,
    but this can be over-ridden by the user.</p></td>
    </tr>
    <tr>
      <th>prob</th>
      <td><p>Target quantile probabilities when training.  If left unspecified,
    uses percentiles (1 through 99) for <code>method = "forest"</code>, and
    for Greenwald-Khanna selects equally spaced percentiles optimized
    for accuracy (see below).</p></td>
    </tr>
    <tr>
      <th>prob.epsilon</th>
      <td><p>Greenwald-Khanna allowable error for quantile
    probabilities when training.</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>Test data (optional) over which conditional quantiles
    are evaluated over.</p></td>
    </tr>
    <tr>
      <th>oob</th>
      <td><p>Return OOB (out-of-bag) quantiles?  If false, in-bag values
    are returned.</p></td>
    </tr>
    <tr>
      <th>fast</th>
      <td><p>Use fast random forests, <code>rfsrcFast</code>, in place of
    <code>rfsrc</code>?  Improves speed but may be less accurate.</p></td>
    </tr>
    <tr>
      <th>maxn</th>
      <td><p>Maximum number of unique y training values used when
    calculating the conditional density.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments to be passed to the <code>rfsrc</code>
    function used for fitting the quantile regression forest.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>The most common method for calculating RF quantiles uses forest
  weights (Meinshausen, 2006).  However we note that the forest weighted
  method used here (specified using <code>method</code>="forest") differs from
  Meinshuasen (2006) in two important ways: (1) local adaptive quantile
  regression splitting is used instead of CART regression mean squared
  splitting, and (2) quantiles are estimated using a weighted local
  cumulative distribution function estimator.  For this reason, results
  may differ from Meinshausen (2006).</p>
<p>A second method uses the Greenwald-Khanna (2001) algorithm (invoked by
  <code>method</code>="gk", "GK", "G-K" or "g-k").  While this will not be as
  accurate as forest weights, the high memory efficiency of
  Greenwald-Khanna makes it feasible to implement in big data settings
  unlike forest weights.</p>
<p>The Greenwald-Khanna algorithm is implemented roughly as follows.  To
  form a distribution of values for each case, from which we sample to
  determine quantiles, we create a chain of values for the case as we
  grow the forest.  Every time a case lands in a terminal node, we
  insert all of its co-inhabitants to its chain of values.</p>
<p>The best case scenario is when tree node size is 1 because each case
  gets only one insert into its chain for that tree.  The worst case
  scenario is when node size is so large that trees stump. This is
  because each case receives insertions for the entire in-bag
  population.</p>
<p>What the user needs to know is that Greenwald-Khanna can become slow
  in counter-intutive settings such as when node size is large.  The
  easy fix is to change the epsilon quantile approximation that is
  requested.  You will see a significant speed-up just by doubling
  <code>prob.epsilon</code>.  This is because the chains stay a lot smaller as
  epsilon increases, which is exactly what you want when node sizes are
  large. Both time and space requirements for the algorithm are affected
  by epsilon.</p>
<p>The best results for Greenwald-Khanna come from setting the number of
  quantiles equal to 2 times the sample size and epsilon to 1 over 2
  times the sample size which is the default values used if left
  unspecified.  This will be slow, especially for big data, and less
  stringent choices should be used if computational speed is of concern.</p>
<p>Finally the default method, <code>method</code>="local", implements the
  locally adjusted cdf estimator of Zhang et al. (2019).  This is the
  default procedure used here as it does not rely on forest weights and
  is therefore fast and can be used for large data.  However be aware
  this relies on the assumption of homogeneity of the error
  distribution, i.e. that errors are iid and therefore have equal
  variance.  Now while reasonably robust to departures of homogeneity,
  there are instances where this may perform poorly; see Zhang et
  al. (2019) for details.  If hetereogeneity is suspected we recommend
  <code>method</code>="forest" instead.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    

<p>Returns the object <code>quantreg</code> containing quantiles for each of
  the requested probabilities (which can be conveniently extracted using
  <code>get.quantile</code>).  Also contains the conditional density (and
  conditional cdf) for each case in the training data (or test data if
  provided) evaluated at each of the unique grow y-values.  The
  conditional density can be used to calculate conditional moments, such
  as the mean and standard deviation.  Use <code>get.quantile.stat</code> as a
  way to conveniently obtain these quantities.</p>
<p>For multivariate forests, returned values will be a list of length
  equal to the number of target outcomes.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Hemant Ishwaran and Udaya B. Kogalur</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Greenwald M. and Khanna S. (2001).  Space-efficient online computation of
  quantile summaries. <em>Proceedings of ACM SIGMOD</em>, 30(2):58-66.</p>
<p>Meinshausen N. (2006) Quantile regression forests, <em>Journal of
  Machine Learning Research</em>, 7:983-999.</p>
<p>Zhang H., Zimmerman J., Nettleton D. and Nordman D.J. (2019).  Random
  forest prediction intervals. <em>The American Statistician</em>. 4:1-5.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code class='command'><a href='rfsrc.html'>rfsrc</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># \donttest{</span>
<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## regression example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## standard call</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>mtcars</span><span class='op'>)</span>

<span class='co'>## extract conditional quantiles</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>get.quantile</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>get.quantile</span><span class='op'>(</span><span class='va'>o</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.25</span>, <span class='fl'>.50</span>, <span class='fl'>.75</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## extract conditional mean and standard deviation</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>get.quantile.stat</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## continuous rank probabiliy score (crps) performance</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>get.quantile.crps</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"l"</span><span class='op'>)</span>


<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## train/test regression example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## train (grow) call followed by test call</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>mtcars</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>o.tst</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>o</span>, newdata <span class='op'>=</span> <span class='va'>mtcars</span><span class='op'>[</span><span class='op'>-</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>,<span class='op'>]</span><span class='op'>)</span>

<span class='co'>## extract test set quantiles and conditional statistics</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>get.quantile</span><span class='op'>(</span><span class='va'>o.tst</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>get.quantile.stat</span><span class='op'>(</span><span class='va'>o.tst</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## quantile regression for Boston Housing using forest method</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'>"mlbench"</span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>

  <span class='co'>## quantile regression with mse splitting</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>BostonHousing</span><span class='op'>)</span>
  <span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>medv</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>BostonHousing</span>, method <span class='op'>=</span> <span class='st'>"forest"</span>, nodesize <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

  <span class='co'>## continuous rank probabiliy score (crps)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>get.quantile.crps</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"l"</span><span class='op'>)</span>

  <span class='co'>## quantile regression plot</span>
  <span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span>, <span class='fl'>.05</span>, <span class='fl'>.95</span><span class='op'>)</span>
  <span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span>, <span class='fl'>.25</span>, <span class='fl'>.75</span><span class='op'>)</span>

  <span class='co'>## (A) extract 25,50,75 quantiles</span>
  <span class='va'>quant.dat</span> <span class='op'>&lt;-</span> <span class='fu'>get.quantile</span><span class='op'>(</span><span class='va'>o</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.25</span>, <span class='fl'>.50</span>, <span class='fl'>.75</span><span class='op'>)</span><span class='op'>)</span>

  <span class='co'>## (B) values expected under normality</span>
  <span class='va'>quant.stat</span> <span class='op'>&lt;-</span> <span class='fu'>get.quantile.stat</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>
  <span class='va'>c.mean</span> <span class='op'>&lt;-</span> <span class='va'>quant.stat</span><span class='op'>$</span><span class='va'>mean</span>
  <span class='va'>c.std</span> <span class='op'>&lt;-</span> <span class='va'>quant.stat</span><span class='op'>$</span><span class='va'>std</span>
  <span class='va'>q.25.est</span> <span class='op'>&lt;-</span> <span class='va'>c.mean</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='fl'>.25</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>c.std</span>
  <span class='va'>q.75.est</span> <span class='op'>&lt;-</span> <span class='va'>c.mean</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='fl'>.75</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>c.std</span>

  <span class='co'>## compare (A) and (B)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>quant.dat</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>2</span><span class='op'>]</span>,  <span class='va'>q.25.est</span>, <span class='va'>q.75.est</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>


<span class='op'>}</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## multivariate mixed outcomes example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='va'>dta</span> <span class='op'>&lt;-</span> <span class='va'>mtcars</span>
<span class='va'>dta</span><span class='op'>$</span><span class='va'>cyl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dta</span><span class='op'>$</span><span class='va'>cyl</span><span class='op'>)</span>
<span class='va'>dta</span><span class='op'>$</span><span class='va'>carb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>dta</span><span class='op'>$</span><span class='va'>carb</span>, ordered <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>carb</span>, <span class='va'>mpg</span>, <span class='va'>cyl</span>, <span class='va'>disp</span><span class='op'>)</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>dta</span><span class='op'>)</span>

<span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span>, m.target <span class='op'>=</span> <span class='st'>"mpg"</span><span class='op'>)</span>
<span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span>, m.target <span class='op'>=</span> <span class='st'>"disp"</span><span class='op'>)</span>


<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## example of quantile regression for ordinal data</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## use the wine data for illustration</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>wine</span>, package <span class='op'>=</span> <span class='st'>"randomForestSRC"</span><span class='op'>)</span>

<span class='co'>## run quantile regression</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>quality</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>wine</span>, ntree <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>

<span class='co'>## extract "probabilities" = density values</span>
<span class='va'>qo.dens</span> <span class='op'>&lt;-</span> <span class='va'>o</span><span class='op'>$</span><span class='va'>quantreg</span><span class='op'>$</span><span class='va'>density</span>
<span class='va'>yunq</span> <span class='op'>&lt;-</span> <span class='va'>o</span><span class='op'>$</span><span class='va'>quantreg</span><span class='op'>$</span><span class='va'>yunq</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>qo.dens</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>yunq</span>

<span class='co'>## convert y to a factor</span>
<span class='va'>yvar</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='va'>o</span><span class='op'>$</span><span class='va'>yvar</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='va'>yunq</span><span class='op'>)</span>, labels <span class='op'>=</span> <span class='va'>yunq</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## confusion matrix</span>
<span class='va'>qo.confusion</span> <span class='op'>&lt;-</span> <span class='fu'>get.confusion</span><span class='op'>(</span><span class='va'>yvar</span>, <span class='va'>qo.dens</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>qo.confusion</span><span class='op'>)</span>

<span class='co'>## normalized Brier score</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Brier:"</span>, <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'>get.brier.error</span><span class='op'>(</span><span class='va'>yvar</span>, <span class='va'>qo.dens</span><span class='op'>)</span>, <span class='st'>"\n"</span><span class='op'>)</span>


<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## example of large data using Greenwald-Khanna algorithm</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## load the data and do quick and dirty imputation</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>housing</span>, package <span class='op'>=</span> <span class='st'>"randomForestSRC"</span><span class='op'>)</span>
<span class='va'>housing</span> <span class='op'>&lt;-</span> <span class='fu'><a href='impute.rfsrc.html'>impute</a></span><span class='op'>(</span><span class='va'>SalePrice</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>housing</span>,
         ntree <span class='op'>=</span> <span class='fl'>50</span>, nimpute <span class='op'>=</span> <span class='fl'>1</span>, splitrule <span class='op'>=</span> <span class='st'>"random"</span><span class='op'>)</span>

<span class='co'>## Greenwald-Khanna algorithm</span>
<span class='co'>## request a small number of quantiles</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>SalePrice</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>housing</span>, method <span class='op'>=</span> <span class='st'>"gk"</span>,
        prob <span class='op'>=</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>20</span>, prob.epsilon <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fl'>20</span>, ntree <span class='op'>=</span> <span class='fl'>250</span><span class='op'>)</span>
<span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## using mse splitting with local cdf method for large data</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## load the data and do quick and dirty imputation</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>housing</span>, package <span class='op'>=</span> <span class='st'>"randomForestSRC"</span><span class='op'>)</span>
<span class='va'>housing</span> <span class='op'>&lt;-</span> <span class='fu'><a href='impute.rfsrc.html'>impute</a></span><span class='op'>(</span><span class='va'>SalePrice</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>housing</span>,
         ntree <span class='op'>=</span> <span class='fl'>50</span>, nimpute <span class='op'>=</span> <span class='fl'>1</span>, splitrule <span class='op'>=</span> <span class='st'>"random"</span><span class='op'>)</span>

<span class='co'>## use mse splitting and reduce number of trees</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>quantreg</span><span class='op'>(</span><span class='va'>SalePrice</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>housing</span>, splitrule <span class='op'>=</span> <span class='st'>"mse"</span>, ntree <span class='op'>=</span> <span class='fl'>250</span><span class='op'>)</span>
<span class='fu'><a href='plot.quantreg.rfsrc.html'>plot.quantreg</a></span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>



<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Min Lu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


